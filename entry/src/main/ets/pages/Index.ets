/**
 * FocusZone ä¸»é¡µ
 * ä½¿ç”¨ Tab + è‡ªå®šä¹‰ç»„ä»¶ å®ç°åº•éƒ¨å¯¼èˆª
 * é¡ºåº: å·¥å…·ç®± â†’ è®¡åˆ’ â†’ æˆé•¿ â†’ è®°å½• â†’ æ—¥å† â†’ ä¸“æ³¨
 */
import { FocusTimerTab } from '../components/FocusTimerTab'
import { PlansTab } from '../components/PlansTab'
import { CalendarTab } from '../components/CalendarTab'
import { NotebookTab } from '../components/NotebookTab'
import { GrowthTab } from '../components/GrowthTab'
import { ToolboxTab } from '../components/ToolboxTab'
import curves from '@ohos.curves'

@Entry
@Component
struct Index {
  @State currentIndex: number = 5
  @State tabBarOpacity: number = 0
  @State tabBarTranslateY: number = 60
  // åˆ·æ–°è®¡æ•°å™¨ï¼šæ¯æ¬¡ä»äºŒçº§é¡µé¢è¿”å›æ—¶ +1ï¼Œé€šçŸ¥å­ç»„ä»¶åˆ·æ–°æ•°æ®
  @State @Watch('onRefreshChange') refreshCounter: number = 0
  @Provide('refreshCounter') refreshProvide: number = 0

  // Tab é¡¹é…ç½®ï¼ˆæ–°é¡ºåºï¼šå·¥å…·ç®± â†’ è®¡åˆ’ â†’ æˆé•¿ â†’ è®°å½• â†’ æ—¥å† â†’ ä¸“æ³¨ï¼‰
  private tabItems: TabItemInfo[] = [
    { title: 'å·¥å…·ç®±', icon: 'ğŸ§°' },
    { title: 'è®¡åˆ’', icon: 'ğŸ“‹' },
    { title: 'æˆé•¿', icon: 'ğŸŒ±' },
    { title: 'è®°å½•', icon: 'ğŸ“' },
    { title: 'æ—¥å†', icon: 'ğŸ“…' },
    { title: 'ä¸“æ³¨', icon: 'â±' }
  ]

  aboutToAppear(): void {
    // Tab æ å…¥åœºå¼¹æ€§åŠ¨ç”»
    setTimeout(() => {
      animateTo({
        duration: 800,
        curve: curves.springCurve(0, 1, 328, 34)
      }, () => {
        this.tabBarOpacity = 1
        this.tabBarTranslateY = 0
      })
    }, 200)
  }

  // ä»äºŒçº§é¡µé¢è¿”å›æ—¶è§¦å‘åˆ·æ–°
  onPageShow(): void {
    this.refreshCounter++
    this.refreshProvide = this.refreshCounter
  }

  onRefreshChange(): void {
    this.refreshProvide = this.refreshCounter
  }

  @Builder
  tabBuilder(index: number) {
    Column() {
      Text(this.tabItems[index].icon)
        .fontSize(22)
        .margin({ bottom: 2 })
      Text(this.tabItems[index].title)
        .fontSize(9)
        .fontWeight(this.currentIndex === index ? FontWeight.Bold : FontWeight.Normal)
        .fontColor(this.currentIndex === index ? $r('app.color.tab_active') : $r('app.color.tab_inactive'))
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
  }

  build() {
    Column() {
      Tabs({ barPosition: BarPosition.End, index: this.currentIndex }) {
        // Tab 1: å·¥å…·ç®±
        TabContent() {
          ToolboxTab()
        }
        .tabBar(this.tabBuilder(0))

        // Tab 2: è®¡åˆ’
        TabContent() {
          PlansTab()
        }
        .tabBar(this.tabBuilder(1))

        // Tab 3: æˆé•¿
        TabContent() {
          GrowthTab()
        }
        .tabBar(this.tabBuilder(2))

        // Tab 4: è®°å½•ï¼ˆç¬”è®°ï¼‰
        TabContent() {
          NotebookTab()
        }
        .tabBar(this.tabBuilder(3))

        // Tab 5: æ—¥å†
        TabContent() {
          CalendarTab()
        }
        .tabBar(this.tabBuilder(4))

        // Tab 6: ä¸“æ³¨ï¼ˆé»˜è®¤æ‰“å¼€æ­¤Tabï¼‰
        TabContent() {
          FocusTimerTab()
        }
        .tabBar(this.tabBuilder(5))
      }
      .barHeight(56)
      .barMode(BarMode.Fixed)
      .onChange((index: number) => {
        this.currentIndex = index
      })
      .opacity(this.tabBarOpacity)
      .translate({ y: this.tabBarTranslateY })
    }
    .width('100%')
    .height('100%')
    .backgroundColor($r('app.color.bg_page'))
  }
}

// Tab é¡¹ä¿¡æ¯æ¥å£
interface TabItemInfo {
  title: string
  icon: string
}
